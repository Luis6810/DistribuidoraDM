@using System.Text.Json
@using System.Text
@inject HttpClient Http
<form @onsubmit="InsertarProductoProveedor" method="post">
  
  <div class="form-group">
    <label for="tipos">Tipos de Provedores</label>
 <select @bind="productoProveedor.IdProveedor"  name="tipos" id="tipos">
                    <option value="0">--Proveedor--</option>
                    @if (tiposProductos != null)
                    {
                        @foreach (var tipo in tiposProductos)
                        {
                            <option value="@tipo.Id">@tipo.Nombre</option>
                        }
                    }

                </select>
  </div>
  <div class="form-group">
    <label for="ClaveProducto">Clave Producto</label>
    <input type="text" class="form-control" id="ClaveProducto" @bind="productoProveedor.Clave" placeholder="Clave Producto">
  </div>
  <div class="form-group">
    <label for="Costo">Costo</label>
    <input @bind="productoProveedor.Precio" type="number" class="form-control" id="Costo" placeholder="Costo">
  </div>
 
  <button hidden="@(!botonGuardar)" type="submit" class="btn btn-primary">Actualizar</button>
</form>

<SuccessMessage Mostrar=@mostrarMensajeExitoso Contenido="@contenidoMensajeExitoso" />
<ErrorMessage Mostrar="@mostrarMensajeError" Contenido="@contenidoMensajeError" />


@code {
    private ProductoProveedor? productoProveedor = new ProductoProveedor();
    private TipoProducto[]? tiposProductos;

    private bool mostrarMensajeExitoso = false;
    private bool mostrarMensajeError = false;
    private string contenidoMensajeExitoso = "";
    private string contenidoMensajeError = "";


    private bool botonGuardar = true;



    [Parameter] public int idProducto { get; set; }

    protected override async Task OnInitializedAsync()
    {

        tiposProductos = await Http.GetFromJsonAsync<TipoProducto[]>(Config.BaseApiUrl + "TipoProductos");

        base.OnInitialized();
    }

    protected async Task InsertarProductoProveedor()
    {
        var httpClient = new HttpClient();
        productoProveedor.IdProducto = idProducto;

        var jsonContent = JsonSerializer.Serialize(productoProveedor);
        Console.WriteLine(jsonContent);

        var response = await httpClient.PostAsync(Config.BaseApiUrl+"ProductoProv/Insertar", new StringContent(jsonContent, Encoding.UTF8, "application/json"));


        if (response.IsSuccessStatusCode)
        {
            MostrarMensajeExitoso("Se actualizaron los datos correctamente");
        }
        else
        {
            MostrarMensajeError("Hubo un error al actualizar los datos");

        }

        botonGuardar = false;

    }

   private void MostrarMensajeExitoso(string contenido)
    {
        mostrarMensajeExitoso = true;
        contenidoMensajeExitoso = contenido;
    }

    private void MostrarMensajeError(string contenido)
    {
        mostrarMensajeError = true;
        contenidoMensajeError = contenido;
    }
}
